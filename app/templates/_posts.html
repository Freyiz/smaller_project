<ul class="posts">
    {% for post in posts %}
        <li class="post">
            <div class="post-thumbnail">
                <a href="{{ url_for('.user', username=post.author.username) }}">
                    {% if post.author.avatar %}
                        <img src="{{ post.author.avatar }}" width="40" height="40" class="img-rounded profile-thumbnail">
                    {% else %}
                        <img src="{{ post.author.wow_avatar }}" width="40" height="40" class="img-rounded profile-thumbnail">
                    {% endif %}
                </a>
            </div>
            <div class="post-content">
                <div class="post-date">{{ moment(post.timestamp).fromNow() }}</div>
                <div class="post-author">
                    <a style="color: {{ post.author.class_color }}" href="{{ url_for('.user', username=post.author.username) }}">
                        {{ post.author.username }}
                    </a>
                </div>
                <div class="post-body">
                    <a href="{{ url_for('.post', id=post.id) }}">
                        {% if post.body_html %}
                            {{ post.body_html | safe }}
                        {% else %}
                            {{ post.body }}
                        {% endif %}
                    </a>
                    <div>
                        {{ post.comments.count() }}
                        <a class="fa fa-comments" href="{{ url_for('.post', id=post.id) }}"></a>
                        {% if current_user.is_authenticated %}
                            {% if post not in current_user.posts_collected.all() %}
                                <a class="fa fa-heart-o" id="post_collect{{ post.id }}" onclick="post_collect('{{ post.id }}', '#post_collect{{ post.id }}', '收藏成功！<a href=\'{{ url_for('.post', id=post.id) }}\'>查看</a>')"></a>
                            {% endif %}
                        {% endif %}
                    </div>
                    <div class="post-footer">
                        {% if current_user == post.author %}
                            <a href="{{ url_for('.edit_post', id=post.id) }}">
                                <span class="label label-default">编辑</span>
                            </a>
                        {% elif current_user.is_administrator() %}
                            <a href="{{ url_for('.edit_post', id=post.id) }}">
                                <span class="label label-danger">编辑-管理员</span>
                            </a>
                        {% endif %}
                    </div>
                </div>
            </div>
        </li>
    {% endfor %}
</ul>
<script src="{{ url_for('static', filename='notification/js/classie.js') }}"></script>
<script src="{{ url_for('static', filename='notification/js/notificationFx.js') }}"></script>
<script type="text/javascript">
    function post_collect(post_id, a_id, message) {
        $.getJSON($SCRIPT_ROOT + '/collect-toggle', {
            id: post_id
        }, function(data) {
            $(a_id).hide();
        });
        var notification = new NotificationFx({
            message : message,
            layout : 'growl',
            ttl : 5000,
            effect : 'genie',
            type : 'notice'
        });
        notification.show();
    }
</script>